{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport { Table, Button } from 'semantic-ui-react';\nimport web3 from '../ethereum/web3';\nimport Web3 from 'web3';\nimport Campaign from '../ethereum/campaign';\nimport { Router } from '../routes';\n\nclass RequestRow extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      loading1: false,\n      loading2: false\n    });\n\n    _defineProperty(this, \"onApprove\", async () => {\n      /*\n      var web3Provider;\n      if (window.ethereum) {\n          web3Provider = window.ethereum;\n          try {\n              // 请求 账户授权\n              await window.ethereum.enable();\n              console.log('account access success.');\n          } catch (error) {\n              // 用户不授权时\n              console.error(\"User denied account access\")\n          }\n      }\n      // Legacy dapp browsers...\n      else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n          web3Provider = window.web3.currentProvider;\n          console.log('!!!!!!!!!!!!!!!!!');\n      }\n      // Non-dapp browsers...\n      else {\n          console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n      }\n      web3 = new Web3(web3Provider);\n       */\n      this.verify();\n      this.setState({\n        loading1: true\n      });\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.approvalRequest(this.props.id).send({\n        from: accounts[0]\n      });\n      time.sleep(500);\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n      this.setState({\n        loading1: false\n      });\n    });\n\n    _defineProperty(this, \"onFinalize\", async () => {\n      this.verify();\n      this.setState({\n        loading2: true\n      });\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.finalizeRequest(this.props.id).send({\n        from: accounts[0]\n      });\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n      this.setState({\n        loading2: false\n      });\n    });\n  }\n\n  async verify() {\n    var web3Provider;\n\n    if (window.ethereum) {\n      web3Provider = window.ethereum;\n\n      try {\n        // 请求 账户授权\n        await window.ethereum.enable();\n        console.log('account access success.');\n      } catch (error) {\n        // 用户不授权时\n        console.error(\"User denied account access\");\n      }\n    } // Legacy dapp browsers...\n    else if (window.web3) {\n        // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n      } // Non-dapp browsers...\n      else {\n          console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n        }\n\n    web3 = new Web3(web3Provider);\n  }\n\n  render() {\n    const {\n      Row,\n      Cell\n    } = Table;\n    const {\n      id,\n      request,\n      approversCount\n    } = this.props;\n    return __jsx(Row, {\n      disabled: request.complete\n    }, __jsx(Cell, null, id), __jsx(Cell, null, request.description), __jsx(Cell, null, web3.utils.fromWei(request.value, 'ether')), __jsx(Cell, null, request.recipients), __jsx(Cell, null, request.approvalCount, \"/\", approversCount), __jsx(Cell, null, request.complete || request.approvalCount == approversCount ? '通过' : __jsx(Button, {\n      color: \"green\",\n      onClick: this.onApprove,\n      loading: this.state.loading1\n    }, \"\\u540C\\u610F\")), __jsx(Cell, null, request.complete ? '已完成' : __jsx(Button, {\n      color: \"teal\",\n      onClick: this.onFinalize,\n      loading: this.state.loading2\n    }, \"\\u5B8C\\u6210\")));\n  }\n\n}\n\nexport default RequestRow;","map":{"version":3,"sources":["/Users/andy/Downloads/exam3/campaign_contract/components/RequestRow.js"],"names":["React","Component","Table","Button","web3","Web3","Campaign","Router","RequestRow","loading1","loading2","verify","setState","campaign","props","address","accounts","eth","getAccounts","methods","approvalRequest","id","send","from","time","sleep","replaceRoute","finalizeRequest","web3Provider","window","ethereum","enable","console","log","error","currentProvider","render","Row","Cell","request","approversCount","complete","description","utils","fromWei","value","recipients","approvalCount","onApprove","state","onFinalize"],"mappings":"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","sourcesContent":["import React,{Component} from 'react';\nimport {Table,Button} from 'semantic-ui-react';\n\nimport web3 from '../ethereum/web3';\nimport Web3 from 'web3';\nimport Campaign from '../ethereum/campaign'\nimport {Router} from '../routes';\n\nclass RequestRow extends Component {\n\n\n  state = {\n    loading1:false,\n    loading2:false,\n  }\n\n  async verify() {\n    var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    web3 = new Web3(web3Provider);\n  }\n\n  onApprove = async()=> {\n\n    /*\n    var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    web3 = new Web3(web3Provider);\n\n    */\n\n      this.verify();\n\n      this.setState({loading1:true});\n\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.approvalRequest(this.props.id).send({from:accounts[0]});\n\n      time.sleep(500);\n\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n\n      this.setState({loading1:false});\n\n  }\n\n  onFinalize = async()=> {\n      this.verify();\n\n      this.setState({loading2:true});\n\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.finalizeRequest(this.props.id).send({from:accounts[0]});\n\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n\n      this.setState({loading2:false});\n  }\n\n  render(){\n\n    const {Row,Cell} = Table;\n    const {id,request,approversCount} = this.props;\n\n    return (\n\n      <Row disabled= {request.complete}>\n        <Cell>{id}</Cell>\n        <Cell>{request.description}</Cell>\n        <Cell>{web3.utils.fromWei(request.value,'ether')}</Cell>\n        <Cell>{request.recipients}</Cell>\n        <Cell>{request.approvalCount}/{approversCount}</Cell>\n        <Cell>\n          {\n            (request.complete || request.approvalCount == approversCount)?'通过':(<Button color='green' onClick={this.onApprove} loading={this.state.loading1}>同意</Button>)\n          }\n        </Cell>\n        <Cell>\n          {\n            request.complete?('已完成'):(<Button color='teal' onClick={this.onFinalize} loading={this.state.loading2}>完成</Button>)\n          }\n        </Cell>\n      </Row>\n\n    );\n  }\n\n}\n\nexport default RequestRow;\n"]},"metadata":{},"sourceType":"module"}