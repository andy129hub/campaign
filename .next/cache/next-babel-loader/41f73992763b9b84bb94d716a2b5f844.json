{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport factory from '../ethereum/factory';\nimport { Card, Button } from 'semantic-ui-react';\nimport Layout from '../components/Layout';\nimport web3 from '../ethereum/web3';\nimport Web3 from 'web3'; // export default()=> {\n//   return <h1>next index页面</h1>;\n// }\n\nclass CampaignIndex extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      account: ''\n    });\n  }\n\n  /*\n    async componentDidMount() {\n      // let list = [];\n      this.props.campaigns.forEach(async  (address, i) => {\n        console.log(\"address : \",address);\n  \n        const desc = await factory.methods.campaignMap(address).call();\n        console.log(\"desc : \", desc);\n        var item = {\n          address : address,\n          desc: desc,\n        }\n        this.state.list.push(item);\n        console.log(\"+++++++list.length : \", this.state.list.length);\n  \n  \n        console.log(\"+++++++what1 : \", this.state.list.length);\n        this.state.list.forEach((l, j) => {\n          console.log(\"foreach address : \",l.address);\n          console.log(\"foreach desc : \",l.desc);\n        });\n        console.log(\"+++++++what2 : \", this.state.list.length);\n  \n  \n      });\n  \n  \n    }\n    */\n  // next 框架中预处理函数(在服务器端预处理，返回结果，供前端调用)\n  // 缺点：无法使用 window 对象\n  // 注意：console.log() 既然是 服务器端处理，所以打印信息是在服务器端的 终端窗口，而不是 浏览器终端\n  static async getInitialProps() {\n    // const address = await factory.options.address;\n    // console.log(address);\n    const campaigns = await factory.methods.getDeployedCampaign().call();\n    console.log(\"========cam0 : \", campaigns[0]);\n    let list = [];\n    campaigns.forEach(async (address, i) => {\n      console.log(\"address : \", address);\n      const desc = await factory.methods.campaignMap(address).call();\n      console.log(\"desc : \", desc);\n      var item = {\n        address: address,\n        desc: desc\n      };\n      list.push(item);\n      console.log(\"+++++++list.length : \", list.length);\n      console.log(\"+++++++what1 : \", list.length);\n      list.forEach((l, j) => {\n        console.log(\"foreach address : \", l.address);\n        console.log(\"foreach desc : \", l.desc);\n      });\n      console.log(\"+++++++what2 : \", list.length);\n    });\n    /*\n    const camDesc = await Promise.all (\n        Array(campaigns.length).fill().map((element,index)=>{\n       //  console.log(\"--------\",this.props.address);\n         return factory.methods.campaignMap(\"0x98fFC345da842d88134C29A5400fd85De438Bb55\").call();\n      })\n    )\n    */\n\n    /*\n    const campaigns = await Promise.all (\n      Array(campaignsCount).fill().map((element,index)=>{\n        return factory.methods.deployedCampaign(index).call();\n      })\n    )\n    console.log(campaigns);\n    */\n\n    return {\n      campaigns,\n      list\n    }; // {} 一定要有\n  } // 既然在服务器端无法获取 以太坊账户信息，那么依然可以使用 componentDidMount() 在里面使用 window对象 请求账户授权\n  // 缺点，一旦 浏览器禁止了 javascript, 那么该方法就无法使用了\n\n  /*\n  async componentDidMount() {\n     var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    console.log('+++++++++++++++++');\n    web3 = new Web3(web3Provider);\n     // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n    const accounts = await web3.eth.getAccounts();\n    console.log(accounts);\n     this.setState({account:accounts[0]});\n  }\n  */\n\n  /*  当浏览器禁止 javascript 之后，console.log() 不会被执行\n    async componentDidMount() {\n  \n      // 请求 账户授权\n      window.addEventListener('load', async () => {\n        var web3Provider;\n         // Modern dapp browsers...\n         if (window.ethereum) {\n             web3Provider = window.ethereum;\n             try {\n                 // 请求 账户授权\n                 await window.ethereum.enable();\n                 console.log('account access success.');\n             } catch (error) {\n                 // 用户不授权时\n                 console.error(\"User denied account access\")\n             }\n         }\n         // Legacy dapp browsers...\n         else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n             web3Provider = window.web3.currentProvider;\n             console.log('!!!!!!!!!!!!!!!!!');\n         }\n         // Non-dapp browsers...\n         else {\n             console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n         }\n         console.log('+++++++++++++++++');\n         web3 = new Web3(web3Provider);\n      });\n  \n      const address = await factory.options.address;\n      console.log(address);\n  \n      // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n      const accounts = await web3.eth.getAccounts();\n      console.log(accounts);\n  \n      const campaign = await factory.methods.getDeployedCampaign().call();\n      console.log(campaign);\n    }\n  */\n\n\n  renderCampaigns() {\n    console.log(this.props.list);\n\n    if (this.props.campaigns.length > 0) {\n      console.log(\"===============enter\");\n      const items = this.props.list.map(item => {\n        return {\n          header: `${item.address}`,\n          description: `${item.desc}`,\n          meta: __jsx(\"a\", null, \"\\u67E5\\u770B\\u4F17\\u7B79\"),\n          fluid: true\n        };\n      });\n      return __jsx(Card.Group, {\n        items: items\n      });\n    } else {\n      console.log(\"no campaign\");\n      const items = [{\n        header: '无众筹项目'\n      }];\n      return __jsx(Card.Group, {\n        items: items\n      });\n    }\n  }\n\n  render() {\n    return __jsx(Layout, null, __jsx(\"div\", null, __jsx(\"h3\", null, \"\\u4F17\\u7B79\\u5217\\u8868\"), __jsx(Button, {\n      floated: \"right\",\n      content: \"\\u521B\\u5EFA\\u4F17\\u7B79\",\n      icon: \"add circle\",\n      labelPosition: \"left\",\n      primary: true\n    }), this.renderCampaigns()));\n  }\n\n} // 导出\n\n\nexport default CampaignIndex;","map":{"version":3,"sources":["/Users/andy/Downloads/exam3/campaign_contract/pages/index.js"],"names":["React","Component","factory","Card","Button","Layout","web3","Web3","CampaignIndex","account","getInitialProps","campaigns","methods","getDeployedCampaign","call","console","log","list","forEach","address","i","desc","campaignMap","item","push","length","l","j","renderCampaigns","props","items","map","header","description","meta","fluid","render"],"mappings":";;;;AAAA,OAAOA,KAAP,IAAcC,SAAd,QAA8B,OAA9B;AACA,OAAOC,OAAP,MAAoB,qBAApB;AACA,SAAQC,IAAR,EAAaC,MAAb,QAA0B,mBAA1B;AAEA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,IAAP,MAAiB,kBAAjB;AAEA,OAAOC,IAAP,MAAiB,MAAjB,C,CACA;AACA;AACA;;AAGA,MAAMC,aAAN,SAA4BP,SAA5B,CAAsC;AAAA;AAAA;;AAAA,mCAE5B;AACNQ,MAAAA,OAAO,EAAC;AADF,KAF4B;AAAA;;AAKtC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BE;AACA;AACA;AACA,eAAaC,eAAb,GAA+B;AAE7B;AACA;AAEA,UAAMC,SAAS,GAAG,MAAMT,OAAO,CAACU,OAAR,CAAgBC,mBAAhB,GAAsCC,IAAtC,EAAxB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BL,SAAS,CAAC,CAAD,CAAvC;AAEA,QAAIM,IAAI,GAAG,EAAX;AAEAN,IAAAA,SAAS,CAACO,OAAV,CAAkB,OAAQC,OAAR,EAAiBC,CAAjB,KAAuB;AACvCL,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAAyBG,OAAzB;AAEA,YAAME,IAAI,GAAG,MAAMnB,OAAO,CAACU,OAAR,CAAgBU,WAAhB,CAA4BH,OAA5B,EAAqCL,IAArC,EAAnB;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBK,IAAvB;AACA,UAAIE,IAAI,GAAG;AACTJ,QAAAA,OAAO,EAAGA,OADD;AAETE,QAAAA,IAAI,EAAEA;AAFG,OAAX;AAIAJ,MAAAA,IAAI,CAACO,IAAL,CAAUD,IAAV;AACAR,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCC,IAAI,CAACQ,MAA1C;AAGAV,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BC,IAAI,CAACQ,MAApC;AACAR,MAAAA,IAAI,CAACC,OAAL,CAAa,CAACQ,CAAD,EAAIC,CAAJ,KAAU;AACrBZ,QAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAiCU,CAAC,CAACP,OAAnC;AACAJ,QAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BU,CAAC,CAACL,IAAhC;AACD,OAHD;AAIAN,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BC,IAAI,CAACQ,MAApC;AAGD,KArBD;AAuBA;;;;;;;;;AAWA;;;;;;;;;AASA,WAAO;AAACd,MAAAA,SAAD;AAAWM,MAAAA;AAAX,KAAP,CArD6B,CAqDF;AAE5B,GA7FmC,CA+FpC;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CEW,EAAAA,eAAe,GAAE;AACfb,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAKa,KAAL,CAAWZ,IAAvB;;AACA,QAAI,KAAKY,KAAL,CAAWlB,SAAX,CAAqBc,MAArB,GAA8B,CAAlC,EAAqC;AACnCV,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACA,YAAMc,KAAK,GAAG,KAAKD,KAAL,CAAWZ,IAAX,CAAgBc,GAAhB,CAAoBR,IAAI,IAAI;AACxC,eAAO;AACLS,UAAAA,MAAM,EAAG,GAAET,IAAI,CAACJ,OAAQ,EADnB;AAELc,UAAAA,WAAW,EAAG,GAAEV,IAAI,CAACF,IAAK,EAFrB;AAGLa,UAAAA,IAAI,EAAE,4CAHD;AAILC,UAAAA,KAAK,EAAC;AAJD,SAAP;AAMD,OAPa,CAAd;AASA,aAAO,MAAC,IAAD,CAAM,KAAN;AAAY,QAAA,KAAK,EAAEL;AAAnB,QAAP;AACD,KAZD,MAYM;AACJf,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,YAAMc,KAAK,GAAG,CACZ;AACEE,QAAAA,MAAM,EAAE;AADV,OADY,CAAd;AAKA,aAAO,MAAC,IAAD,CAAM,KAAN;AAAY,QAAA,KAAK,EAAEF;AAAnB,QAAP;AACD;AAEF;;AAEDM,EAAAA,MAAM,GAAG;AACP,WACE,MAAC,MAAD,QACA,mBACE,6CADF,EAEE,MAAC,MAAD;AAAQ,MAAA,OAAO,EAAC,OAAhB;AAAwB,MAAA,OAAO,EAAC,0BAAhC;AAAuC,MAAA,IAAI,EAAC,YAA5C;AAAyD,MAAA,aAAa,EAAC,MAAvE;AAA8E,MAAA,OAAO;AAArF,MAFF,EAGG,KAAKR,eAAL,EAHH,CADA,CADF;AASD;;AApNmC,C,CAsNtC;;;AACA,eAAepB,aAAf","sourcesContent":["import React,{Component} from 'react';\nimport factory from '../ethereum/factory';\nimport {Card,Button} from 'semantic-ui-react';\n\nimport Layout from '../components/Layout';\nimport web3 from '../ethereum/web3';\n\nimport Web3 from 'web3';\n// export default()=> {\n//   return <h1>next index页面</h1>;\n// }\n\n\nclass CampaignIndex extends Component {\n\n  state = {\n    account:'',\n  }\n/*\n  async componentDidMount() {\n    // let list = [];\n    this.props.campaigns.forEach(async  (address, i) => {\n      console.log(\"address : \",address);\n\n      const desc = await factory.methods.campaignMap(address).call();\n      console.log(\"desc : \", desc);\n      var item = {\n        address : address,\n        desc: desc,\n      }\n      this.state.list.push(item);\n      console.log(\"+++++++list.length : \", this.state.list.length);\n\n\n      console.log(\"+++++++what1 : \", this.state.list.length);\n      this.state.list.forEach((l, j) => {\n        console.log(\"foreach address : \",l.address);\n        console.log(\"foreach desc : \",l.desc);\n      });\n      console.log(\"+++++++what2 : \", this.state.list.length);\n\n\n    });\n\n\n  }\n  */\n\n  // next 框架中预处理函数(在服务器端预处理，返回结果，供前端调用)\n  // 缺点：无法使用 window 对象\n  // 注意：console.log() 既然是 服务器端处理，所以打印信息是在服务器端的 终端窗口，而不是 浏览器终端\n  static async getInitialProps() {\n\n    // const address = await factory.options.address;\n    // console.log(address);\n\n    const campaigns = await factory.methods.getDeployedCampaign().call();\n    console.log(\"========cam0 : \",campaigns[0]);\n\n    let list = [];\n\n    campaigns.forEach(async  (address, i) => {\n      console.log(\"address : \",address);\n\n      const desc = await factory.methods.campaignMap(address).call();\n      console.log(\"desc : \", desc);\n      var item = {\n        address : address,\n        desc: desc,\n      }\n      list.push(item);\n      console.log(\"+++++++list.length : \", list.length);\n\n\n      console.log(\"+++++++what1 : \", list.length);\n      list.forEach((l, j) => {\n        console.log(\"foreach address : \",l.address);\n        console.log(\"foreach desc : \",l.desc);\n      });\n      console.log(\"+++++++what2 : \", list.length);\n\n\n    });\n\n    /*\n    const camDesc = await Promise.all (\n        Array(campaigns.length).fill().map((element,index)=>{\n\n      //  console.log(\"--------\",this.props.address);\n\n        return factory.methods.campaignMap(\"0x98fFC345da842d88134C29A5400fd85De438Bb55\").call();\n      })\n    )\n    */\n\n    /*\n    const campaigns = await Promise.all (\n      Array(campaignsCount).fill().map((element,index)=>{\n        return factory.methods.deployedCampaign(index).call();\n      })\n    )\n    console.log(campaigns);\n    */\n\n    return {campaigns,list};   // {} 一定要有\n\n  }\n\n  // 既然在服务器端无法获取 以太坊账户信息，那么依然可以使用 componentDidMount() 在里面使用 window对象 请求账户授权\n  // 缺点，一旦 浏览器禁止了 javascript, 那么该方法就无法使用了\n  /*\n  async componentDidMount() {\n\n    var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    console.log('+++++++++++++++++');\n    web3 = new Web3(web3Provider);\n\n    // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n    const accounts = await web3.eth.getAccounts();\n    console.log(accounts);\n\n    this.setState({account:accounts[0]});\n  }\n  */\n\n\n/*  当浏览器禁止 javascript 之后，console.log() 不会被执行\n  async componentDidMount() {\n\n    // 请求 账户授权\n    window.addEventListener('load', async () => {\n      var web3Provider;\n       // Modern dapp browsers...\n       if (window.ethereum) {\n           web3Provider = window.ethereum;\n           try {\n               // 请求 账户授权\n               await window.ethereum.enable();\n               console.log('account access success.');\n           } catch (error) {\n               // 用户不授权时\n               console.error(\"User denied account access\")\n           }\n       }\n       // Legacy dapp browsers...\n       else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n           web3Provider = window.web3.currentProvider;\n           console.log('!!!!!!!!!!!!!!!!!');\n       }\n       // Non-dapp browsers...\n       else {\n           console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n       }\n       console.log('+++++++++++++++++');\n       web3 = new Web3(web3Provider);\n    });\n\n    const address = await factory.options.address;\n    console.log(address);\n\n    // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n    const accounts = await web3.eth.getAccounts();\n    console.log(accounts);\n\n    const campaign = await factory.methods.getDeployedCampaign().call();\n    console.log(campaign);\n  }\n*/\n\n  renderCampaigns(){\n    console.log(this.props.list);\n    if (this.props.campaigns.length > 0 ){\n      console.log(\"===============enter\");\n      const items = this.props.list.map(item => {\n        return {\n          header: `${item.address}`,\n          description :`${item.desc}`,\n          meta: <a>查看众筹</a>,\n          fluid:true\n        }\n      });\n\n      return <Card.Group items={items} />;\n    }else {\n      console.log(\"no campaign\");\n      const items = [\n        {\n          header: '无众筹项目',\n        },\n      ]\n      return <Card.Group items={items} />;\n    }\n\n  }\n\n  render() {\n    return (\n      <Layout>\n      <div>\n        <h3>众筹列表</h3>\n        <Button floated='right' content='创建众筹' icon='add circle' labelPosition='left' primary/>\n        {this.renderCampaigns()}\n      </div>\n      </Layout>\n    );\n  }\n}\n// 导出\nexport default CampaignIndex;\n"]},"metadata":{},"sourceType":"module"}