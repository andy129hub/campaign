{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport factory from '../ethereum/factory';\nimport { Card, Button } from 'semantic-ui-react';\nimport Layout from '../components/Layout';\nimport web3 from '../ethereum/web3';\nimport Web3 from 'web3'; // export default()=> {\n//   return <h1>next index页面</h1>;\n// }\n\nclass CampaignIndex extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      account: ''\n    });\n  }\n\n  // next 框架中预处理函数(在服务器端预处理，返回结果，供前端调用)\n  // 缺点：无法使用 window 对象\n  // 注意：console.log() 既然是 服务器端处理，所以打印信息是在服务器端的 终端窗口，而不是 浏览器终端\n  static async getInitialProps() {\n    // const address = await factory.options.address;\n    // console.log(address);\n    const campaigns = await factory.methods.getDeployedCampaign().call();\n    console.log(campaigns);\n    return {\n      campaigns\n    }; // {} 一定要有\n  } // 既然在服务器端无法获取 以太坊账户信息，那么依然可以使用 componentDidMount() 在里面使用 window对象 请求账户授权\n  // 缺点，一旦 浏览器禁止了 javascript, 那么该方法就无法使用了\n\n  /*\n  async componentDidMount() {\n     var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    console.log('+++++++++++++++++');\n    web3 = new Web3(web3Provider);\n     // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n    const accounts = await web3.eth.getAccounts();\n    console.log(accounts);\n     this.setState({account:accounts[0]});\n  }\n  */\n\n  /*  当浏览器禁止 javascript 之后，console.log() 不会被执行\n    async componentDidMount() {\n  \n      // 请求 账户授权\n      window.addEventListener('load', async () => {\n        var web3Provider;\n         // Modern dapp browsers...\n         if (window.ethereum) {\n             web3Provider = window.ethereum;\n             try {\n                 // 请求 账户授权\n                 await window.ethereum.enable();\n                 console.log('account access success.');\n             } catch (error) {\n                 // 用户不授权时\n                 console.error(\"User denied account access\")\n             }\n         }\n         // Legacy dapp browsers...\n         else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n             web3Provider = window.web3.currentProvider;\n             console.log('!!!!!!!!!!!!!!!!!');\n         }\n         // Non-dapp browsers...\n         else {\n             console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n         }\n         console.log('+++++++++++++++++');\n         web3 = new Web3(web3Provider);\n      });\n  \n      const address = await factory.options.address;\n      console.log(address);\n  \n      // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n      const accounts = await web3.eth.getAccounts();\n      console.log(accounts);\n  \n      const campaign = await factory.methods.getDeployedCampaign().call();\n      console.log(campaign);\n    }\n  */\n\n\n  renderCampaigns() {\n    const items = this.props.campaigns.map(address => {\n      return {\n        header: address,\n        description: 'Leverage agile frameworks to provide a robust synopsis for high level overviews.',\n        meta: __jsx(\"a\", null, \"\\u67E5\\u770B\\u4F17\\u7B79\"),\n        fluid: true\n      };\n    });\n    return __jsx(Card.Group, {\n      items: items\n    });\n  }\n\n  render() {\n    return __jsx(Layout, null, __jsx(\"div\", null, __jsx(\"link\", {\n      rel: \"stylesheet\",\n      href: \"//cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css\"\n    }), this.renderCampaigns(), __jsx(Button, {\n      content: \"\\u521B\\u5EFA\\u4F17\\u7B79\",\n      icon: \"add circle\",\n      labelPosition: \"left\",\n      primary: true\n    })));\n  }\n\n} // 导出\n\n\nexport default CampaignIndex;","map":{"version":3,"sources":["/Users/andy/Downloads/exam3/campaign_contract/pages/index.js"],"names":["React","Component","factory","Card","Button","Layout","web3","Web3","CampaignIndex","account","getInitialProps","campaigns","methods","getDeployedCampaign","call","console","log","renderCampaigns","items","props","map","address","header","description","meta","fluid","render"],"mappings":";;;;AAAA,OAAOA,KAAP,IAAcC,SAAd,QAA8B,OAA9B;AACA,OAAOC,OAAP,MAAoB,qBAApB;AACA,SAAQC,IAAR,EAAaC,MAAb,QAA0B,mBAA1B;AAEA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,IAAP,MAAiB,kBAAjB;AAEA,OAAOC,IAAP,MAAiB,MAAjB,C,CACA;AACA;AACA;;AAGA,MAAMC,aAAN,SAA4BP,SAA5B,CAAsC;AAAA;AAAA;;AAAA,mCAE5B;AACNQ,MAAAA,OAAO,EAAC;AADF,KAF4B;AAAA;;AAMpC;AACA;AACA;AACA,eAAaC,eAAb,GAA+B;AAE7B;AACA;AAEA,UAAMC,SAAS,GAAG,MAAMT,OAAO,CAACU,OAAR,CAAgBC,mBAAhB,GAAsCC,IAAtC,EAAxB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAYL,SAAZ;AAEA,WAAO;AAACA,MAAAA;AAAD,KAAP,CAR6B,CAQP;AACvB,GAlBmC,CAoBpC;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CEM,EAAAA,eAAe,GAAE;AACf,UAAMC,KAAK,GAAG,KAAKC,KAAL,CAAWR,SAAX,CAAqBS,GAArB,CAAyBC,OAAO,IAAE;AAC9C,aAAO;AACLC,QAAAA,MAAM,EAAED,OADH;AAELE,QAAAA,WAAW,EACb,kFAHO;AAILC,QAAAA,IAAI,EAAE,4CAJD;AAKLC,QAAAA,KAAK,EAAC;AALD,OAAP;AAOD,KARa,CAAd;AAUA,WAAO,MAAC,IAAD,CAAM,KAAN;AAAY,MAAA,KAAK,EAAEP;AAAnB,MAAP;AACD;;AAEDQ,EAAAA,MAAM,GAAG;AACP,WACE,MAAC,MAAD,QACA,mBACA;AAAM,MAAA,GAAG,EAAC,YAAV;AAAuB,MAAA,IAAI,EAAC;AAA5B,MADA,EAEG,KAAKT,eAAL,EAFH,EAGA,MAAC,MAAD;AAAQ,MAAA,OAAO,EAAC,0BAAhB;AAAuB,MAAA,IAAI,EAAC,YAA5B;AAAyC,MAAA,aAAa,EAAC,MAAvD;AAA8D,MAAA,OAAO;AAArE,MAHA,CADA,CADF;AASD;;AA7HmC,C,CA+HtC;;;AACA,eAAeT,aAAf","sourcesContent":["import React,{Component} from 'react';\nimport factory from '../ethereum/factory';\nimport {Card,Button} from 'semantic-ui-react';\n\nimport Layout from '../components/Layout';\nimport web3 from '../ethereum/web3';\n\nimport Web3 from 'web3';\n// export default()=> {\n//   return <h1>next index页面</h1>;\n// }\n\n\nclass CampaignIndex extends Component {\n\n  state = {\n    account:'',\n  }\n\n  // next 框架中预处理函数(在服务器端预处理，返回结果，供前端调用)\n  // 缺点：无法使用 window 对象\n  // 注意：console.log() 既然是 服务器端处理，所以打印信息是在服务器端的 终端窗口，而不是 浏览器终端\n  static async getInitialProps() {\n\n    // const address = await factory.options.address;\n    // console.log(address);\n\n    const campaigns = await factory.methods.getDeployedCampaign().call();\n    console.log(campaigns);\n\n    return {campaigns};   // {} 一定要有\n  }\n\n  // 既然在服务器端无法获取 以太坊账户信息，那么依然可以使用 componentDidMount() 在里面使用 window对象 请求账户授权\n  // 缺点，一旦 浏览器禁止了 javascript, 那么该方法就无法使用了\n  /*\n  async componentDidMount() {\n\n    var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    console.log('+++++++++++++++++');\n    web3 = new Web3(web3Provider);\n\n    // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n    const accounts = await web3.eth.getAccounts();\n    console.log(accounts);\n\n    this.setState({account:accounts[0]});\n  }\n  */\n\n\n/*  当浏览器禁止 javascript 之后，console.log() 不会被执行\n  async componentDidMount() {\n\n    // 请求 账户授权\n    window.addEventListener('load', async () => {\n      var web3Provider;\n       // Modern dapp browsers...\n       if (window.ethereum) {\n           web3Provider = window.ethereum;\n           try {\n               // 请求 账户授权\n               await window.ethereum.enable();\n               console.log('account access success.');\n           } catch (error) {\n               // 用户不授权时\n               console.error(\"User denied account access\")\n           }\n       }\n       // Legacy dapp browsers...\n       else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n           web3Provider = window.web3.currentProvider;\n           console.log('!!!!!!!!!!!!!!!!!');\n       }\n       // Non-dapp browsers...\n       else {\n           console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n       }\n       console.log('+++++++++++++++++');\n       web3 = new Web3(web3Provider);\n    });\n\n    const address = await factory.options.address;\n    console.log(address);\n\n    // 请求账户授权，授权完成之后才可以通过  web3.eth.getAccounts() 获取到账户信息\n    const accounts = await web3.eth.getAccounts();\n    console.log(accounts);\n\n    const campaign = await factory.methods.getDeployedCampaign().call();\n    console.log(campaign);\n  }\n*/\n\n  renderCampaigns(){\n    const items = this.props.campaigns.map(address=>{\n      return {\n        header: address,\n        description:\n      'Leverage agile frameworks to provide a robust synopsis for high level overviews.',\n        meta: <a>查看众筹</a>,\n        fluid:true,\n      }\n    });\n\n    return <Card.Group items={items} />;\n  }\n\n  render() {\n    return (\n      <Layout>\n      <div>\n      <link rel=\"stylesheet\" href=\"//cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css\" />\n        {this.renderCampaigns()}\n      <Button content='创建众筹' icon='add circle' labelPosition='left' primary/>\n      </div>\n      </Layout>\n    );\n  }\n}\n// 导出\nexport default CampaignIndex;\n"]},"metadata":{},"sourceType":"module"}