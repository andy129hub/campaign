{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport { Table, Button } from 'semantic-ui-react';\nimport web3 from '../ethereum/web3';\nimport Web3 from 'web3';\nimport Campaign from '../ethereum/campaign';\nimport { Router } from '../../../routes';\n\nclass RequestRow extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      loading: false\n    });\n\n    _defineProperty(this, \"onApprove\", async () => {\n      /*\n      var web3Provider;\n      if (window.ethereum) {\n          web3Provider = window.ethereum;\n          try {\n              // 请求 账户授权\n              await window.ethereum.enable();\n              console.log('account access success.');\n          } catch (error) {\n              // 用户不授权时\n              console.error(\"User denied account access\")\n          }\n      }\n      // Legacy dapp browsers...\n      else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n          web3Provider = window.web3.currentProvider;\n          console.log('!!!!!!!!!!!!!!!!!');\n      }\n      // Non-dapp browsers...\n      else {\n          console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n      }\n      web3 = new Web3(web3Provider);\n       */\n      this.verify();\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.approvalRequest(this.props.id).send({\n        from: accounts[0]\n      });\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n    });\n\n    _defineProperty(this, \"onFinalize\", async () => {\n      this.verify();\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.finalizeRequest(this.props.id).send({\n        from: accounts[0]\n      });\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n    });\n  }\n\n  async verify() {\n    var web3Provider;\n\n    if (window.ethereum) {\n      web3Provider = window.ethereum;\n\n      try {\n        // 请求 账户授权\n        await window.ethereum.enable();\n        console.log('account access success.');\n      } catch (error) {\n        // 用户不授权时\n        console.error(\"User denied account access\");\n      }\n    } // Legacy dapp browsers...\n    else if (window.web3) {\n        // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n      } // Non-dapp browsers...\n      else {\n          console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n        }\n\n    web3 = new Web3(web3Provider);\n  }\n\n  render() {\n    const {\n      Row,\n      Cell\n    } = Table;\n    const {\n      id,\n      request,\n      approversCount\n    } = this.props;\n    return __jsx(Row, null, __jsx(Cell, null, id), __jsx(Cell, null, request.description), __jsx(Cell, null, web3.utils.fromWei(request.value, 'ether')), __jsx(Cell, null, request.recipients), __jsx(Cell, null, request.approvalCount, \"/\", approversCount), __jsx(Cell, null, __jsx(Button, {\n      color: \"green\",\n      onClick: this.onApprove,\n      loading: this.state.loading1\n    }, \"\\u540C\\u610F\")), __jsx(Cell, null, __jsx(Button, {\n      color: \"green\",\n      onClick: this.onFinalize,\n      loading: this.state.loading2\n    }, \"\\u5B8C\\u6210\")));\n  }\n\n}\n\nexport default RequestRow;","map":{"version":3,"sources":["/Users/andy/Downloads/exam3/campaign_contract/components/RequestRow.js"],"names":["React","Component","Table","Button","web3","Web3","Campaign","Router","RequestRow","loading","verify","campaign","props","address","accounts","eth","getAccounts","methods","approvalRequest","id","send","from","replaceRoute","finalizeRequest","web3Provider","window","ethereum","enable","console","log","error","currentProvider","render","Row","Cell","request","approversCount","description","utils","fromWei","value","recipients","approvalCount","onApprove","state","loading1","onFinalize","loading2"],"mappings":"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","sourcesContent":["import React,{Component} from 'react';\nimport {Table,Button} from 'semantic-ui-react';\n\nimport web3 from '../ethereum/web3';\nimport Web3 from 'web3';\nimport Campaign from '../ethereum/campaign'\nimport {Router} from '../../../routes';\n\nclass RequestRow extends Component {\n\n\n  state = {\n    loading:false,\n  }\n\n  async verify() {\n    var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    web3 = new Web3(web3Provider);\n  }\n\n  onApprove = async()=> {\n\n    /*\n    var web3Provider;\n    if (window.ethereum) {\n        web3Provider = window.ethereum;\n        try {\n            // 请求 账户授权\n            await window.ethereum.enable();\n            console.log('account access success.');\n        } catch (error) {\n            // 用户不授权时\n            console.error(\"User denied account access\")\n        }\n    }\n    // Legacy dapp browsers...\n    else if (window.web3) {   // 老版本 metamask 账户信息是公开的，2018-11之后，需要授权才能获取账户信息\n        web3Provider = window.web3.currentProvider;\n        console.log('!!!!!!!!!!!!!!!!!');\n    }\n    // Non-dapp browsers...\n    else {\n        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n    web3 = new Web3(web3Provider);\n\n    */\n\n      this.verify();\n\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.approvalRequest(this.props.id).send({from:accounts[0]});\n\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n\n  }\n\n  onFinalize = async()=> {\n      this.verify();\n\n      const campaign = Campaign(this.props.address);\n      const accounts = await web3.eth.getAccounts();\n      await campaign.methods.finalizeRequest(this.props.id).send({from:accounts[0]});\n\n      Router.replaceRoute(`/campaigns/${this.props.address}/requests`);\n  }\n\n  render(){\n\n    const {Row,Cell} = Table;\n    const {id,request,approversCount} = this.props;\n\n    return (\n\n      <Row>\n        <Cell>{id}</Cell>\n        <Cell>{request.description}</Cell>\n        <Cell>{web3.utils.fromWei(request.value,'ether')}</Cell>\n        <Cell>{request.recipients}</Cell>\n        <Cell>{request.approvalCount}/{approversCount}</Cell>\n        <Cell>\n            <Button color='green' onClick={this.onApprove} loading={this.state.loading1}>同意</Button>\n        </Cell>\n        <Cell>\n            <Button color='green' onClick={this.onFinalize} loading={this.state.loading2}>完成</Button>\n        </Cell>\n      </Row>\n\n    );\n  }\n\n}\n\nexport default RequestRow;\n"]},"metadata":{},"sourceType":"module"}